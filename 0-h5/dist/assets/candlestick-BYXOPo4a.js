var e=Object.defineProperty,o=(o,r,t)=>(((o,r,t)=>{r in o?e(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t})(o,"symbol"!=typeof r?r+"":r,t),t);import{c as r,r as t,e as i,a0 as l,A as a,an as s,ax as n,a5 as c,o as m,a as d,k as u,F as p,p as b,n as y,u as v,t as h,ap as _,i as g}from"./vendor-DNdropHc.js";import{d as C,e as S,_ as f,a as w,u as k,ag as P,ah as D,q as E,k as L}from"./index-D_GDdZsP.js";class A{constructor(e){o(this,"self",null),o(this,"subscribers",{}),o(this,"requestsPending",!1),o(this,"barList",[]),this.self=e}onReady(e){this.self.getConfig(e)}async getBars(e,o,r,t,i,l,a){if(this.requestsPending)return;a&&(this.barList=[],r=""),this.requestsPending=!0;const s=await this.self.getBars({symbolInfo:e,resolution:o,from:r,to:t,onHistoryCallback:i,onErrorCallback:l,firstDataRequest:a});this.requestsPending=!1,s&&s.length?(this.barList=s.concat(this.barList),this.barList.length?i(this.barList,{noData:!1,nextTime:this.barList[0].time}):i([],{noData:!0})):i([],{noData:!0})}subscribeBars(e,o,r,t,i){this.subscribers[t]||(this.subscribers[t]={lastBarTime:null,resolution:o,onRealtimeCallback:r,onResetCacheNeededCallback:i})}unsubscribeBars(e){this.subscribers[e]&&delete this.subscribers[e]}async resolveSymbol(e,o,r){return o(await this.self.resolveSymbol())}updateData(e){let o=Object.keys(this.subscribers)[0]||"",r=this.subscribers[o]||{};if(r.lastBarTime<e.time)this.barList.push(e),r.lastBarTime=e.time,(null==r?void 0:r.onRealtimeCallback)&&(null==r||r.onRealtimeCallback(e));else if(r.lastBarTime==e.time){let o=this.barList.slice(-1);Object.keys(o).forEach((r=>{o[r]=e[r]})),(null==r?void 0:r.onRealtimeCallback)&&(null==r||r.onRealtimeCallback(e))}}getMarks(){}getTimescaleMarks(){}calculateHistoryDepth(e,o,r){}}const B=["adaptive_logo","dont_show_boolean_study_arguments","hide_left_toolbar_by_defaul","side_toolbar_in_fullscreen_mode","disable_resolution_rebuild","seconds_resolution","hide_last_na_study_output"],I=["widget_logo","symbol_info","go_to_date","compare_symbol","header_compare","symbol_search_hot_key","left_toolbar","volume_force_overlay","header_saveload","contextmenu","display_market_status","pane_context_menu","timeframes_toolbar","snapshot_trading_drawings","use_localstorage_for_settings","header_symbol_search","header_undo_redo","header_screenshot","property_pages","header_resolutions","lock_visible_time_range_on_resize","source_selection_markers","header_widget","edit_buttons_in_legend","show_hide_button_in_legend","format_button_in_legend","study_buttons_in_legend","delete_button_in_legend","main_series_scale_menu","---show_interval_dialog_on_key_press","adaptive_logo"],M={"volume.volume.color.0":"#d62548","volume.volume.color.1":"#4bbd83","volume.volume transparency":70,"volume.options.showStudyArguments":!0,"volume.volume ma.color":"#FF0000","volume.volume ma.transparency":100,"volume.volume ma.linewidth":2,"volume.show ma":!0,"MACD.MACD.color":"#2196F3","MACD.MACD.linewidth":2,"MACD.Signal.color":"#FF6D00","MACD.Signal.linewidth":2,"MACD.Histogram.plottype":"columns","MACD.Histogram.color":"#22AB94","bollinger bands.transparency":0,"bollinger bands.background":"rgba(0,0,0,0)","bollinger bands.median.color":"#FF6D00","bollinger bands.upper.color":"#2196F3","bollinger bands.upper.linewidth":2,"bollinger bands.lower.color":"#2196F3","bollinger bands.lower.linewidth":2},F=e=>{var o={light:{up:"#4BBD83",down:"#D62548",bg:"#ffffff",grid:"#F2F4F7",cross:"#333",border:"#f7f8fa",text:"#7D8AA3",line:"#ECECEC"},dark:{up:"#4BBD83",down:"#D62548",bg:"#202329",grid:"#35393E",cross:"#999",border:"#35393E",text:"#999",line:"#35393E"}}[e];return{volumePaneSize:"medium","paneProperties.legendProperties.showSeriesTitle":!0,"paneProperties.legendProperties.showSeriesOHLC":!1,"paneProperties.legendProperties.showLegend":!0,"paneProperties.legendProperties.showBarChange":!1,"paneProperties.legendProperties.showOnlyPriceSource":!1,"mainSeriesProperties.priceAxisProperties.autoScale":!0,"mainSeriesProperties.style":1,"mainSeriesProperties.priceLineWidth":2,"mainSeriesProperties.areaStyle.color1":"rgba(75, 189, 131, 1)","mainSeriesProperties.areaStyle.color2":"rgba(255, 255, 255, 1)","mainSeriesProperties.areaStyle.linecolor":"#4BBD83","mainSeriesProperties.areaStyle.linewidth":4,"paneProperties.topMargin":30,"paneProperties.bottomMargin":5,"mainSeriesProperties.statusViewStyle.symbolTextSource":"name","scalesProperties.lineColor":o.line,"scalesProperties.textColor":o.text,"scalesProperties.fontSize":12,"paneProperties.background":o.bg,"paneProperties.vertGridProperties.color":o.grid,"paneProperties.horzGridProperties.color":o.grid,"paneProperties.crossHairProperties.color":o.cross,"paneProperties.crossHairProperties.style":2,"mainSeriesProperties.candleStyle.upColor":o.up,"mainSeriesProperties.candleStyle.downColor":o.down,"mainSeriesProperties.candleStyle.drawWick":!0,"mainSeriesProperties.candleStyle.drawBorder":!0,"mainSeriesProperties.candleStyle.borderColor":o.border,"mainSeriesProperties.candleStyle.borderUpColor":o.up,"mainSeriesProperties.candleStyle.borderDownColor":o.down,"mainSeriesProperties.candleStyle.wickUpColor":o.up,"mainSeriesProperties.candleStyle.wickDownColor":o.down,"mainSeriesProperties.candleStyle.barColorsOnPrevClose":!1,"mainSeriesProperties.hollowCandleStyle.upColor":o.up,"mainSeriesProperties.hollowCandleStyle.downColor":o.down,"mainSeriesProperties.hollowCandleStyle.drawWick":!0,"mainSeriesProperties.hollowCandleStyle.drawBorder":!0,"mainSeriesProperties.hollowCandleStyle.borderColor":o.border,"mainSeriesProperties.hollowCandleStyle.borderUpColor":o.up,"mainSeriesProperties.hollowCandleStyle.borderDownColor":o.down,"mainSeriesProperties.hollowCandleStyle.wickColor":o.line,"mainSeriesProperties.haStyle.upColor":o.up,"mainSeriesProperties.haStyle.downColor":o.down,"mainSeriesProperties.haStyle.drawWick":!0,"mainSeriesProperties.haStyle.drawBorder":!0,"mainSeriesProperties.haStyle.borderColor":o.border,"mainSeriesProperties.haStyle.borderUpColor":o.up,"mainSeriesProperties.haStyle.borderDownColor":o.down,"mainSeriesProperties.haStyle.wickColor":o.border,"mainSeriesProperties.haStyle.barColorsOnPrevClose":!1,"mainSeriesProperties.barStyle.upColor":o.up,"mainSeriesProperties.barStyle.downColor":o.down,"mainSeriesProperties.barStyle.barColorsOnPrevClose":!1,"mainSeriesProperties.barStyle.dontDrawOpen":!1,"mainSeriesProperties.lineStyle.color":o.border,"mainSeriesProperties.lineStyle.linewidth":2,"mainSeriesProperties.lineStyle.priceSource":"close"}},O=e=>({light:{backgroundColor:"#ffffff",foregroundColor:"#4BBD83"},dark:{backgroundColor:"#252834",foregroundColor:"#4BBD83"}}[e]),T=e=>({enabled_features:B,disabled_features:I,studies_overrides:M,overrides:F(e),loading_screen:O(e)}),R={class:"third"},N={class:"list"},x={class:"thirdLeft"},U=["onClick"],H={class:"times"},j=["onClick"],q=["id"],W={class:"studyList"},z=["onClick"],Y=f({__name:"candlestick",props:{type:{type:String,default:"detail"},coinInfo:{type:Object,default:()=>{}}},setup(e){const o=e,f=r((()=>{var e,r,t;let i=1e4;return(null==(e=o.coinInfo)?void 0:e.amount)>100?i=100:(null==(r=o.coinInfo)?void 0:r.amount)<.1?i=1e6:(null==(t=o.coinInfo)?void 0:t.amount)<100&&(i=1e4),i})),B={time:"",amount:"",open:"",high:"",low:"",close:"",volume:"",lastClose:"",intervention:!1},I=t(""),M=[{label:"1".concat(S("minute")),value:"1m",interval:"1",key:"ONE_MIN"},{label:"5".concat(S("minute")),value:"5m",interval:"5",key:"FIVE_MIN",market:"mt5"},{label:"15".concat(S("minute")),value:"15m",interval:"15",key:"FIFTEEN_MIN",market:"mt5"},{label:"30".concat(S("minute")),value:"30m",interval:"30",key:"THIRTY_MIN",market:"mt5"},{label:"1".concat(S("hour")),value:"1h",interval:"60",key:"ONE_HOUR",market:"mt5"},{label:"2".concat(S("hour")),value:"2h",interval:"120",key:"TWO_HOUR"},{label:"6".concat(S("hour")),value:"6h",interval:"360",key:"SIX_HOUR",isMore:!0},{label:"1".concat(S("day")),value:"1d",interval:"1d",key:"ONE_DAY",isMore:!0,market:"mt5"},{label:"3".concat(S("day")),value:"3d",interval:"3d",key:"ONE_DAY",isMore:!0},{label:S("weekly"),value:"1w",interval:"W",key:"ONE_WEEK",isMore:!0,market:"mt5"},{label:S("month"),value:"1M",interval:"M",key:"ONE_MON",isMore:!0}],F=[{label:"MA",name:"Moving Average",colorList:["#E5BF39","#7CC7BA","#C5A0E0"],cycleList:[5,10,30],studyList:[]},{label:"EMA",name:"Moving Average Exponential",colorList:["#E5BF39","#7CC7BA","#C5A0E0"],cycleList:[5,10,30],studyList:[]},{label:"BOLL",name:"Bollinger Bands",colorList:["#E5BF39","#7CC7BA","#C5A0E0"],cycleList:[14],studyList:[]},{label:"MACD",name:"MACD",colorList:["#E5BF39","#7CC7BA","#C5A0E0"],cycleList:[12],studyList:[]},{label:"RSI",name:"Relative Strength Index",colorList:["#7B2B8C","#5FABAC","#886024"],cycleList:[6],studyList:[]},{label:"WR",name:"Williams %R",colorList:["#886024"],cycleList:[14],studyList:[]}],O=i([]),Y=M.filter((e=>null==e?void 0:e.isMore));let K=[],G=null,V=i([]),X=i({}),J=i({});const Q=r((()=>"kline_".concat(o.type)));let Z=null;const $=w(),ee=k(),oe=l.debounce((e=>{let r=e.detail.symbol,t=e.detail.coinInfo,i=te(t);i.map((e=>e.value)).join()!=O.map((e=>e.value)).join()&&(K=re(),O.splice(0,O.length,...i),Object.assign(J,O[0])),ue.value=!1,ie(r,J.interval,(()=>{Object.assign(X,o.coinInfo)}))}),200),re=(e=X)=>{let o=M.map((e=>e.interval));return"mt5"==(null==e?void 0:e.market)&&(o=M.filter((e=>"mt5"==e.market)).map((e=>e.interval))),o},te=(e=X)=>{let o=M.filter((e=>!(null==e?void 0:e.isMore)));return"mt5"!=(null==e?void 0:e.market)&&3!==(null==e?void 0:e.coinType)||(o=M.filter((e=>"mt5"==e.market))),o};a((async()=>{Object.assign(X,o.coinInfo),K=re(),O.splice(0,O.length,...te()),Object.assign(J,O[0]),document.addEventListener("event_tradeSymbolChange",oe),s((()=>{ae()}))})),n((()=>{document.removeEventListener("event_tradeSymbolChange",oe),ce(!0),Z.remove()}));const ie=async(e,o,r)=>{X.symbol==e&&o==J.interval||null==Z||Z.setSymbol(e,o,(()=>{Object.assign(J,M.find((e=>e.interval==o))),r&&r()}))},le={getConfig:async e=>{setTimeout((()=>{e({supported_resolutions:K,supports_marks:!1,supports_timescale_marks:!0,supports_time:!0})}),0)},getServerTime:async e=>{e&&e(+new Date)}};le.getBars=async({symbolInfo:e,resolution:o,from:r,firstDataRequest:t})=>{let i=M.find((e=>e.interval==o));try{if(i&&(""==r||r>0)){let o={symbol:e.coinUpperCase,interval:i.key,limit:1e3};r&&(o.end=r);const{data:a}=await(l={...o,interval:i.key,symbol:e.coinUpperCase,market:e.market},C("/kline",l));let s=[];if(a&&(ee.setKlineTicker(a.ticker),s=a.historyKline),s=s.map((e=>({open:parseFloat(e.o),high:parseFloat(e.h),low:parseFloat(e.l),close:parseFloat(L(e.c)),amount:parseFloat(L(e.c)),volume:parseFloat(e.v),time:e.T}))).sort(((e,o)=>e.time-o.time)),t){let o=s.slice(-1)[0];B.amount=o.amount,B.open=o.open,B.close=o.close,B.high=o.high,B.low=o.low,B.volume=o.volume,B.time=o.time,B.lastClose=o.close,B.intervention=!1,I.value=Math.abs(B.time-s.slice(-2,-1)[0].time),de(B),me({coin:e.coin,symbol:e.symbol,interval:i.key,firstDataRequest:t})}return s}}catch(a){return ce(!0),[]}var l;return[]},le.resolveSymbol=async()=>({name:o.coinInfo.symbolUpperCase,coin:o.coinInfo.coin,coinUpperCase:o.coinInfo.coin,symbol:o.coinInfo.symbol,symbolUpperCase:o.coinInfo.symbolUpperCase,market:o.coinInfo.market,fractional:!1,session:"24x7",has_intraday:!0,has_weekly_and_monthly:!0,exchange:__config._APP_EXCHANGE_NAME,description:o.coinInfo.symbolUpperCase,pricescale:f.value,minmov:1/f.value,supported_resolutions:K});const ae=()=>{G=new A(le);let e=window.__theme;Z=new TradingView.widget({symbol:o.coinInfo.symbolUpperCase,theme:e,debug:!1,autosize:!0,interval:J.interval,container_id:Q.value,datafeed:G,library_path:"/charting_library/",custom_css_url:"../tradingview_".concat(e,".css"),locale:"en",timezone:$.timezone,customFormatters:{dateFormatter:{format:e=>P(e.getTime(),"DD/MM/YYYY",!0)},timeFormatter:{format:e=>P(e.getTime(),"HH:mm:ss",!0)}},preset:"mobile",...T(e)}),Z.onChartReady((()=>{se()}))},se=()=>{let e=ye(F[0].name);V.push(e)},ne=[],ce=(e=!1)=>{X.coin&&(D.send({op:E.unsubscribe,type:E.KLINE,symbol:X.coin,interval:J.key}),e&&(ne.forEach((e=>{e&&c.unsubscribe(e)})),ne.length=0,D.send({op:E.unsubscribe,type:E.TRADE,symbol:X.coin})))},me=async e=>{ce(e.firstDataRequest),D.send({op:E.subscribe,type:E.KLINE,symbol:e.coin,interval:e.interval}),e.firstDataRequest&&D.send({op:E.subscribe,type:E.TRADE,symbol:e.coin});let o=c.subscribe(E.KLINE,((o,r)=>{let t=r.data.tick;if(r.symbol==e.coin){B.intervention!=(null==t?void 0:t.intervention)&&(t.open=B.lastClose,B.intervention=null==t?void 0:t.intervention);let e=parseInt(t.id/I.value)*I.value;B.time<e&&(B.time=e,B.open=t.open),B.high=t.high,B.low=t.low,B.close=Number(L(t.close)),B.volume=t.vol,de(B)}}));ne.push(o)},de=e=>{(null==e?void 0:e.close)&&(G.updateData(e),c.publish(E.DETAIL,{data:{...e,vol:e.volume},origin:"kline",symbol:X.coin,type:E.DETAIL}))};l.throttle((function(e){de(e)}),300);const ue=t(!1),pe=(e,r="")=>{e.interval!=J.interval&&ie(o.coinInfo.symbol,e.interval),ue.value=!!r},be=t(""),ye=e=>{if(be.value==e)return;const o=Z.activeChart();if(be.value){F.filter((e=>e.name==be.value))[0].list.forEach((e=>{o.removeEntity(e)}))}be.value=e;let r=F.filter((e=>e.name==be.value))[0],t=[];r.cycleList.forEach((async(i,l)=>{let a="";a="MACD"==e||"Bollinger Bands"==e?await o.createStudy(be.value,!1,!1,[],{}):await o.createStudy(be.value,!1,!1,[i],{"plot.color":r.colorList[l],"plot.linewidth":2}),t.push(a)})),r.list=t};return(e,o)=>(m(),d(p,null,[u("div",null,[u("div",R,[u("div",N,[u("div",x,[(m(!0),d(p,null,b(v(O),((e,o)=>(m(),d("div",{class:y({"hightItem item ff-num":e.interval===v(J).interval,"item ff-num":!0}),key:o,onClick:o=>pe(e)},h(e.value),11,U)))),128))])])]),v(ue)?(m(),d("div",{key:0,class:"selectTimes",onTouchmove:o[0]||(o[0]=_((()=>{}),["prevent"])),onMousewheel:o[1]||(o[1]=_((()=>{}),["prevent"])),onClick:o[2]||(o[2]=e=>ue.value=!1)},[u("div",H,[(m(!0),d(p,null,b(v(Y),((e,o)=>(m(),d("div",{key:o,class:y({hightItem:e.interval===v(J).interval,"item ff-num":!0}),onClick:o=>pe(e,"menu")},h(e.value),11,j)))),128))])],32)):g("",!0)]),u("div",{id:Q.value,class:"candlestick"},null,8,q),u("div",W,[(m(!0),d(p,null,b(v(F),((e,o)=>(m(),d("div",{class:y(e.name===v(be)?"hightItem studyItem":"studyItem"),key:o,onClick:o=>ye(e.name)},h(e.label),11,z)))),128))])],64))}},[["__scopeId","data-v-2f583be3"]]);export{Y as C};
