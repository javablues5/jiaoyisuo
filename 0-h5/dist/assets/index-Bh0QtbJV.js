import{ar as l,r as a,c as e,N as u,A as n,a0 as o,s as i,a as v,j as s,u as c,k as t,q as d,C as r,t as m,y as p,l as f,w as h,F as _,I as b,o as g,p as y,a1 as C,a2 as k}from"./vendor-DNdropHc.js";import{_ as w,r as I,aQ as P,f as U,aR as x,R as E,x as L,b as A,c as N,e as j,k as S,aS as V}from"./index-D_GDdZsP.js";import{u as F}from"./useFreeze-D4J_klo6.js";import{A as R}from"./applyAmount-CYMNhqin.js";const z={class:"content"},q={class:"from"},D=["placeholder"],Q=(l=>(C("data-v-11b3b0e7"),l=l(),k(),l))((()=>t("span",null,"|",-1))),T={class:"svgImg"},B={class:"exchange_btn"},G={class:"to"},H=["placeholder"],J={class:"svgImg"},K={class:"rate ff-num"},M={class:"btn"},O={class:"coinList"},W=["onClick"],X={class:"svgImg"},Y=w({__name:"index",setup(C){const{_isFreeze:k}=F(),{_toast:w}=I(),Y=P(),Z=U();Z.getUserInfo();const{asset:$}=l(Z),{swapCoinList:ll}=l(Y),al=a(!0),el=a([]),ul=a([]),nl=a({}),ol=a({}),il=a(0),vl=a(0),sl=e((()=>{let l="";return $.value.forEach(((a,e)=>{a.symbol==nl.value.coin&&1==a.type&&(l=a.availableAmount)})),l})),cl=a(0);u([il],(([l],[a])=>{al.value?(el.value.forEach(((a,e)=>{a.coin==l&&(nl.value=a)})),ul.value=ll.value.filter(((l,a)=>l.coin!=nl.value.coin)),l==vl.value&&(ol.value=ll.value.filter(((l,a)=>l.coin!=nl.value.coin))[0],vl.value=ol.value.coin)):el.value.forEach(((a,e)=>{a.coin==l&&(nl.value=a)}))})),u([vl],(([l],[a])=>{al.value?ul.value.forEach(((a,e)=>{a.coin==l&&(ol.value=a)})):(ul.value.forEach(((a,e)=>{a.coin==l&&(ol.value=a)})),el.value=ll.value.filter(((l,a)=>l.coin!=ol.value.coin)),l==vl.value&&(nl.value=ll.value.filter(((l,a)=>l.coin!=ol.value.coin))[0],il.value=ol.value.coin))})),u([nl,ol],((l,a)=>{var e,u,n,o;n=null==(e=l[0])?void 0:e.coin,o=null==(u=l[1])?void 0:u.coin,n=ml(n),o=ml(o),V(n,o).then((l=>{if("200"==l.code){let a=l.data["".concat(n)],e=l.data["".concat(o)];null==a&&(a=1),null==e&&(e=1),cl.value=S(a/e,8)}}))}),{deep:!0});const tl=a(!1),dl=a({}),rl=a("from"),ml=l=>l,pl=a(""),fl=a();u([pl,cl],(()=>{fl.value=S(pl.value*cl.value,8)})),n((()=>{(async()=>{var l,a,e,u;await Y.getSwapCoinList();let n=[];$.value.forEach(((l,a)=>{var e;let u={};"1"==l.type&&(u.id,u.amount=l.availableAmount,"usdt"==l.symbol&&(u.coin="usdt",u.icon="usdt",n.unshift(u)),"usdt"!=l.symbol&&(u.coin=null==(e=l.symbol)?void 0:e.replace("usdt","").trim(),u.icon=l.loge,n.push(u)))})),ll.value.forEach(((l,a)=>{n.forEach(((a,e)=>{a.coin==l.coin&&(l.amount=a.amount)}))})),el.value=n,["gmtoin2"].includes(__config._APP_ENV)?nl.value=n.find(((l,a)=>"btc"===l.coin)):nl.value=n[0],il.value=null==(l=nl.value)?void 0:l.coin,ul.value=null==(a=ll.value)?void 0:a.filter(((l,a)=>{var e;return l.coin!=(null==(e=nl.value)?void 0:e.coin)})),ol.value=null==(e=ll.value)?void 0:e.filter(((l,a)=>{var e;return l.coin!=(null==(e=nl.value)?void 0:e.coin)}))[0],vl.value=null==(u=ol.value)?void 0:u.coin})()}));const hl=l=>{"from"==l?dl.value=el.value:"to"==l&&(dl.value=ul.value),rl.value=l,tl.value=!0},_l=o.debounce((()=>{var l,a;if(pl.value<=0)return void w("swap_minNum");if(pl.value>sl.value)return void w("swap_maxNum");let e={fromSymbol:ml(null==(l=nl.value)?void 0:l.coin),toSymbol:ml(null==(a=ol.value)?void 0:a.coin),total:pl.value};x(e).then((l=>{"200"==l.code?(w("swap_success",["aams"]),setTimeout((()=>{Z.getUserInfo()}),1e3)):i(l.msg)}))}),500),bl=()=>{E.includes(__config._APP_ENV)?k(E)&&_l():_l()};return(l,a)=>{var e,u,n,o,i,C,k,w,I,P,U,x,E,S,V,F;const Y=L,Z=A,$=N,ll=b;return g(),v(_,null,[s(Y,{currentName:c(j)("swap")},null,8,["currentName"]),s(R,{amount:sl.value||0,coin:null==(u=null==(e=nl.value)?void 0:e.coin)?void 0:u.toLocaleUpperCase()},null,8,["amount","coin"]),t("div",z,[t("div",q,[d(t("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=l=>pl.value=l),placeholder:c(j)("swap_input"),class:"ff-num"},null,8,D),[[r,pl.value]]),t("div",null,[t("div",{class:"left",onClick:a[1]||(a[1]=l=>{var a;return pl.value=(null==(a=nl.value)?void 0:a.amount)||"0"})},m(c(j)("swap_all")),1),Q,t("div",{class:"right",onClick:a[2]||(a[2]=l=>hl("from"))},[p(m(null==(o=null==(n=nl.value)?void 0:n.coin)?void 0:o.toLocaleUpperCase())+" ",1),t("div",T,[(null==(C=null==(i=nl.value)?void 0:i.icon)?void 0:C.length)>10?(g(),f(Z,{key:0,filePath:null==(k=nl.value)?void 0:k.icon,alt:"",class:"iconImg"},null,8,["filePath"])):(g(),f($,{key:1,name:null==(w=nl.value)?void 0:w.icon,class:"icon"},null,8,["name"]))])])])]),t("div",B,[s($,{name:"duihuan40x40",class:"dui",onClick:a[3]||(a[3]=l=>(()=>{al.value=!al.value;let l=el.value;el.value=ul.value,ul.value=l;let a=nl.value;nl.value=ol.value,ol.value=a})())})]),t("div",G,[d(t("input",{type:"number",disabled:"",class:"ff-num","onUpdate:modelValue":a[4]||(a[4]=l=>fl.value=l),placeholder:c(j)("swap_number")},null,8,H),[[r,fl.value]]),t("div",null,[t("div",{class:"right",onClick:a[5]||(a[5]=l=>hl("to"))},[p(m(null==(P=null==(I=ol.value)?void 0:I.coin)?void 0:P.toLocaleUpperCase())+" ",1),t("div",J,[(null==(x=null==(U=ol.value)?void 0:U.icon)?void 0:x.length)>10?(g(),f(Z,{key:0,filePath:null==(E=ol.value)?void 0:E.icon,class:"iconImg"},null,8,["filePath"])):(g(),f($,{key:1,name:null==(S=ol.value)?void 0:S.icon,class:"icon"},null,8,["name"]))])])])]),t("div",K,[t("p",null,m(c(j)("swap_rateDay"))+"：",1),p(" 1 "),t("span",null,m(null==(V=nl.value.coin)?void 0:V.toLocaleUpperCase()),1),p(" ≈ "),t("span",null,m(cl.value),1),t("span",null,m(null==(F=ol.value.coin)?void 0:F.toLocaleUpperCase()),1)])]),t("div",M,[t("p",{onClick:bl},m(c(j)("btnConfirm",["bitmake"])),1)]),s(ll,{show:tl.value,"onUpdate:show":a[6]||(a[6]=l=>tl.value=l),title:"",id:"sheetPopup",style:{"max-width":"var(--ex-max-width)",left:"50%",translate:"-50%"}},{default:h((()=>[t("div",O,[(g(!0),v(_,null,y(dl.value,((l,a)=>{var e,u;return g(),v("div",{key:l.id,class:"coinItem",onClick:a=>((l,a)=>{tl.value=!1,"from"==rl.value?il.value=l.coin:"to"==rl.value&&(vl.value=l.coin)})(l)},[t("div",X,[(null==(e=null==l?void 0:l.icon)?void 0:e.length)>10?(g(),f(Z,{key:0,filePath:l.icon,alt:"",class:"iconImg"},null,8,["filePath"])):(g(),f($,{key:1,name:l.icon,class:"icon"},null,8,["name"]))]),t("div",null,[t("p",null,m(null==(u=l.coin)?void 0:u.toLocaleUpperCase()),1)])],8,W)})),128))])])),_:1},8,["show"])],64)}}},[["__scopeId","data-v-11b3b0e7"]]);export{Y as default};
